  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>MongoChat</title>
    <style>
        #messages{height: 300px}
    </style>


    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3 col-sm-12">
                <h1 class="text-center">
                    MongoChat
                    <button id="clear" class="btn btn-danger">Clear</button>
                </h1>
                <div id="status"></div>
                <div id="chat">
                    <input type="text" id="username" class="form-control" placeholder="Enter name">
                    <br>
                    <div class="card">
                        <div id="messages" class="card-block">

                        </div>
                    </div>
                    <br>
                    <textarea id="textarea" class="form-control" 
                    placeholder="Enter message..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>
    <script>
        (function(){
            var element = id=>{
                return document.getElementById(id)
            }   
            //Get elements
            var status = element("status")
            var messages = element("messages")
            var textarea = element("textarea")
            var username = element("username")
            var clearBtn = element("clear")

            // Set default status
            var statusDefault = status.textContent

            var setStatus = s=>{
                //Set status
                status.textContent = s
                if(s !== statusDefault){
                var delay = setTimeout(()=>{
                    setStatus(statusDefault)
                },4000)
            }
        }
         //Connect to socket.io
         var socket = io.connect("http://127.0.0.1:4000")

         //Check for connection
         if(socket !== undefined){
            console.log("Connected to socket...")

            // Handle Output
            socket.on("output",data=>{
                //console.log(data)
                if(data.length){    
                    for(var x=0;x<data.length;x++){
                        var tarih = new Date()
                        var saat = tarih.getHours()
                        var dakika = tarih.getMinutes()
                        var saniye = tarih.getSeconds()
                        var gun = tarih.getDay()
                        var ay = tarih.getMonth()
                        var yil = tarih.getFullYear()
                        //Build out message div
                        var message = document.createElement("div")
                        message.setAttribute("class","chat-message")
                        message.textContent = data[x].name+" : "+data[x].message+"  "+gun+"/"+ay+"/"+yil
                        messages.appendChild(message)
                        messages.insertBefore(message,messages.firstChild)
                    }
                }
            })
            // Get status from server
            socket.on("status",data=>{
                // get message status
                setStatus((typeof data === "object" ? data.message:data))
                
                // if status is clear, clear text
                if(data.clear){
                    textarea.value = ""
                }
            })
            // Handle input
            textarea.addEventListener("keydown",event=>{
                if(event.which === 13 && event.shiftKey == false){
                    // Emit to server input
                    socket.emit("input",{
                        name : username.value,
                        message : textarea.value
                    })
                    event.preventDefault()
                }
            })
            // Handle chat clear
            clearBtn.addEventListener("click",()=>{
                socket.emit("clear")
            })
            // Clear message
            socket.on("cleared",()=>{
                messages.textContent = ""
            })
         }
        })()
    </script>
